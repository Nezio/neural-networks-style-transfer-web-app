@model StyleTransferWebApp.Models.StyleTransferViewModel

@{
    ViewBag.Title = "Home Page";
}

<div id="dropzone" class="flex-container">
    <form action=@Url.Action("UploadContentImage", "Home") class="dropzone flex-child" id="dropzoneContent" enctype="multipart/form-data"></form>
    <form action=@Url.Action("UploadStyleImage", "Home") class="dropzone flex-child" id="dropzoneStyle" enctype="multipart/form-data"></form>
</div>

<div class="col text-center">
    <input type="button" value="Start style transfer" class="btn btn-primary" onclick="location.href='@Url.Action("StartStyleTransfer", "Home")'" />
</div>

<hr />

<div id="userResultsContainer">

</div>


@section Scripts{

    @*rendering section*@
    <script>
        function ImageClick(image) {
            window.open(image.src)
        };

        function Delete(folder) {
            $(function () {
                $.post('/Home/DeleteOutputFolder',
                    { folder: folder }, function (data) {
                        alert(data.message);

                        if (data.success) {
                            window.location.href = '@Url.Action("Index", "Home")';
                        }
                });
            });
        }

        // get data from model
        var styleTransferUserResults = @Html.Raw(Json.Encode(Model.styleTransferUserResults));

        var maxImageWidth = 300;
        var maxButtonImageWidth = 20;

        // render result images for each output folder this user has
        styleTransferUserResults.forEach(function (styleTransferUserResult) {
            var resultContainer = $('<div>');
            resultContainer.attr('class', 'resultContainer')

            // add content image
            var contentImage = $('<img>');
            contentImage.attr('src', '/' + styleTransferUserResult.contentImage);
            contentImage.attr('class', 'image')
            contentImage.attr('width', maxImageWidth)
            contentImage.attr('onClick', 'ImageClick(this)')
            contentImage.appendTo(resultContainer);

            // add style image
            var styleImage = $('<img>');
            styleImage.attr('src', '/' + styleTransferUserResult.styleImage);
            styleImage.attr('class', 'image')
            styleImage.attr('width', maxImageWidth)
            styleImage.attr('onClick', 'ImageClick(this)')
            styleImage.appendTo(resultContainer);

            // add the last generated image
            var generatedImage = $('<img>');
            generatedImage.attr('src', '/' + styleTransferUserResult.generatedImages[styleTransferUserResult.generatedImages.length - 1]);
            generatedImage.attr('class', 'image')
            generatedImage.attr('width', maxImageWidth)
            generatedImage.attr('onClick', 'ImageClick(this)')
            generatedImage.appendTo(resultContainer);

            // add delete button
            var fullFolderPath = styleTransferUserResult.generatedImages[styleTransferUserResult.generatedImages.length - 1];
            var imageName = fullFolderPath.split('/')[fullFolderPath.split('/').length - 1].toLowerCase()
            var folderName = fullFolderPath.split('/')[fullFolderPath.split('/').length - 2]
            if (!imageName.includes('queue') && !imageName.includes('wip') && !imageName.includes('404')) {
                // only add delete button for processed folders
                var deleteButton = $('<img>');
                deleteButton.attr('src', '/Content/Images/delete.png');
                deleteButton.attr('class', 'button-image')
                deleteButton.attr('width', maxButtonImageWidth)
                deleteButton.attr('onClick', 'Delete("' + folderName + '")')

                deleteButton.appendTo(resultContainer);
            }

            // append result container to the user results container
            resultContainer.appendTo($('#userResultsContainer'));
        });


    </script>


    @*initialization for the separate script files*@
    <script>
        var responseMessage = '@Model.responseMessage';
    </script>

    @*include separate script files*@
    <script src="@Url.Content("~/Scripts/Home/index.js")"></script>
}